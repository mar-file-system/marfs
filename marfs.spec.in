# http://stackoverflow.com/questions/880227/what-is-the-minimum-i-have-to-do-to-create-an-rpm-file
# Don't try fancy stuff like debuginfo, which is useless on binary-only
# packages. Don't strip binary too
# Be sure buildpolicy set to do nothing
%define        __spec_install_post %{nil}
%define          debug_package %{nil}
%define        __os_install_post %{_dbpath}/brp-compress
%define        marfs_rev %{_marfs_rev}
%define        marfs_id %{_marfs_id}
Name:		marfs
# Version:	1.6
Version:	%{marfs_version}
Release:	%{marfs_rev}%{?dist}
Summary:	MarFS

Group:		Utilities/System
License:	BSD
URL:		https://github.com/mar-file-system/marfs
# Source0:	%{name}-%{version}.tar.gz
Source0:	%{name}-%{version}.tar.gz
Source1:	marfs-aws4c-%{version}.tar.gz
Source2:	marfs-PA2X-%{version}.tar.gz
BuildRoot:	%{_tmppath}/%{name}-%{version}-%{release}-root

BuildRequires:	libcurl-devel libattr-devel
BuildRequires:	glibc-devel fuse-devel libattr-devel make curl-devel
BuildRequires:	openssl-devel libxml2-devel
Requires:	curl openssl

%description
MarFS provides a scalable near-POSIX file system by using one or more POSIX
file systems as a scalable metadata component and one ore more data stores
(object, file, etc) as a scalable data component. Our initial implementation
will use GPFS file systems as the metadata component and Scality and EMC ECS
ViPR object stores as the data component.


%prep 
%setup -q -n %{name}-%{version}-%{marfs_rev}-%{marfs_id} -a1 -a2


%build
./do_build.sh

%install
rm -rf %{buildroot}
mkdir -p  %{buildroot}
make DESTDIR=%{buildroot} install

# in builddir
#cp -a * %{buildroot}
#install -m 755 ./marfs_config %{buildroot}/usr/bin/
#install -m 755 ./marfs_fuse   %{buildroot}/usr/sbin/
mkdir -p  %{buildroot}/usr/include/marfs/parse-inc/
cp -avr ./PA2X/parse-inc/* %{buildroot}/usr/include/marfs/parse-inc/
find %buildroot -type f \( -name '*.so' -o -name '*.so.*' \) -exec chmod 755 {} \;
find %buildroot -type f -name '*.a'  -exec chmod 644 {} \;


%files
%defattr(-,root,root,-)
%{_bindir}/*
%{_libdir}/libmarfs.so*
%{_libdir}/lib*.a
/usr/lib/marfs/scripts/*
/usr/include/marfs/parse-inc/*
%doc /usr/share/doc/%{name}-%{version}/*





%changelog
* Fri Oct 21 2016  Yuriy Shestakov <yuriy.shestakov@archive-engines.com> 0.92-beta
- Assemble binary RPM 
